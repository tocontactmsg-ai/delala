<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Ø§Ù„Ø¯Ù„Ø§Ù„Ø©</title>
<meta name="description" content="Ù…Ù†ØµØ© Ø§Ù„Ø¯Ù„Ø§Ù„Ø© - Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø³ÙˆØ¯Ø§Ù† Ù„Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø´Ø±Ø§Ø¡" />
<meta name="theme-color" content="#0078d7" />
<style>
  body {
    margin:0;
    font-family:"Cairo",sans-serif;
    background:#f6f8fa;
    color:#222;
    direction:rtl;
  }
  header {
    text-align:center;
    padding:20px;
    background:#0078d7;
    color:#fff;
    font-size:2.5rem;
    font-weight:bold;
    letter-spacing:2px;
    animation:logoGlow 3s ease-in-out infinite;
  }
  @keyframes logoGlow {
    0%,100% { text-shadow:0 0 8px #fff,0 0 20px #0078d7; transform:scale(1); }
    50% { text-shadow:0 0 20px #fff,0 0 40px #00a0ff; transform:scale(1.05); }
  }
  main {
    padding:20px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(270px,1fr));
    gap:16px;
  }
  .card {
    background:#fff;
    border-radius:10px;
    box-shadow:0 3px 8px rgba(0,0,0,.1);
    overflow:hidden;
    opacity:0;
    transform:translateY(20px);
    animation:fadeUp .7s forwards;
  }
  @keyframes fadeUp {
    to {opacity:1;transform:translateY(0);}
  }
  .card img {
    width:100%;
    height:190px;
    object-fit:cover;
  }
  .content { padding:12px 15px 15px; }
  .title { font-weight:700; margin-bottom:6px; color:#0078d7; font-size:1.1rem;}
  .price {color:#28a745;font-weight:700;margin-bottom:6px;}
  .desc {font-size:.9rem;color:#555;margin-bottom:10px;min-height:42px;}
  .time {font-size:.8rem;color:#999;}
  .btn {
    display:inline-block;
    margin-top:8px;
    background:#25D366;
    color:#fff;
    padding:8px 12px;
    border-radius:6px;
    text-decoration:none;
    font-size:.9rem;
    transition:background .2s;
  }
  .btn:hover { background:#1ebe5d; }
  .loader {
    width:48px;height:48px;margin:60px auto;border:4px solid #ddd;border-top-color:#0078d7;border-radius:50%;
    animation:spin 1s linear infinite;
  }
  @keyframes spin { to{transform:rotate(360deg);} }
</style>
</head>
<body>
<header>Ø§Ù„Ø¯Ù„Ø§Ù„Ø©</header>
<main id="adsGrid"></main>
<div id="loader" class="loader"></div>

<script>
const GITHUB_PATH = "https://raw.githubusercontent.com/tocontactmsg-ai/de/main/ads/";
const WHATSAPP_NUMBER = "249998615193";
const CACHE_KEY = "delala_cache_v1";
const CACHE_TIME = 5*60*1000; // 5 min
let ads = [], displayed=0, batch=20, loading=false;

async function fetchAdList(){
  // list ads via GitHub API
  try{
    const res = await fetch("https://api.github.com/repos/tocontactmsg-ai/delala/ads");
    const data = await res.json();
    return data.filter(f=>f.name.endsWith(".json")).map(f=>f.name);
  }catch(e){ console.error("Fetch list error",e); return []; }
}

async function fetchAd(file){
  const url = GITHUB_PATH + file;
  try{
    const res = await fetch(url+"?t="+Date.now());
    if(!res.ok) throw new Error(res.status);
    return await res.json();
  }catch(e){ console.warn("Ad fetch fail",file,e); return null; }
}

function timeSince(ts){
  const now = Date.now(), diff = now - new Date(ts).getTime();
  const mins = Math.floor(diff/60000);
  if(mins<60) return `${mins} Ø¯Ù‚ÙŠÙ‚Ø©`;
  const hrs=Math.floor(mins/60);
  if(hrs<24) return `${hrs} Ø³Ø§Ø¹Ø©`;
  return `${Math.floor(hrs/24)} ÙŠÙˆÙ…`;
}

function renderBatch(){
  const grid=document.getElementById("adsGrid");
  const slice=ads.slice(displayed,displayed+batch);
  slice.forEach(ad=>{
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <img src="${ad.image||''}" alt="${ad.title||'Ø¥Ø¹Ù„Ø§Ù†'}">
      <div class="content">
        <div class="title">${ad.title||'Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</div>
        ${ad.price?`<div class="price">${ad.price}</div>`:''}
        <div class="desc">${ad.description||''}</div>
        <div class="time">Ù…Ù†Ø° ${timeSince(ad.created_at||Date.now())}</div>
        <a class="btn" target="_blank" href="https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(ad.title||'Ø¥Ø¹Ù„Ø§Ù† Ù…Ù† Ø§Ù„Ø¯Ù„Ø§Ù„Ø©')}">ðŸ’¬ ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨</a>
      </div>`;
    grid.appendChild(card);
  });
  displayed+=slice.length;
  if(displayed>=ads.length) document.getElementById("loader").style.display="none";
  loading=false;
}

async function init(){
  const cache=localStorage.getItem(CACHE_KEY);
  if(cache){
    const {time,data}=JSON.parse(cache);
    if(Date.now()-time<CACHE_TIME){ ads=data; showAds(); return; }
  }
  const files=await fetchAdList();
  const fetched=await Promise.all(files.map(fetchAd));
  ads=fetched.filter(Boolean).sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));
  localStorage.setItem(CACHE_KEY,JSON.stringify({time:Date.now(),data:ads}));
  showAds();
}

function showAds(){
  document.getElementById("loader").style.display="none";
  renderBatch();
}

window.addEventListener("scroll",()=>{
  if(window.innerHeight+window.scrollY>=document.body.offsetHeight-400 && !loading){
    loading=true; renderBatch();
  }
});

window.addEventListener("load",()=>{ init(); });
</script>
</body>
</html>
