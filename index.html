<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Hub | Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø·Ø¨ÙŠ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }
        .glass { background: white; border: 1px solid #e2e8f0; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .nav-active { border-bottom: 4px solid #2563eb; color: #2563eb; font-weight: 900; }
        input, textarea { width: 100%; padding: 0.8rem; border: 1px solid #cbd5e1; border-radius: 0.75rem; outline: none; transition: 0.2s; }
        input:focus { border-color: #2563eb; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// --- CONFIGURATION ---
const CONFIG = {
    user: "tocontactmsg-ai",
    repo: "delala",
    folder: "ads",
    whatsapp: "249998615193"
};

function App() {
    const [view, setView] = useState("feed");
    const [data, setData] = useState([]);
    const [loading, setLoading] = useState(false);
    const [status, setStatus] = useState("Initializing...");
    const [items, setItems] = useState([{ name: "", qty: "" }]);
    const [fileResult, setFileResult] = useState(null);

    // Load Data safely
    const loadContent = async () => {
        setLoading(true);
        setStatus("Connecting to Database...");
        try {
            const apiUrl = `https://api.github.com/repos/${CONFIG.user}/${CONFIG.repo}/contents/${CONFIG.folder}`;
            const response = await fetch(apiUrl);
            
            if (!response.ok) throw new Error("Could not find the 'ads' folder. Please check GitHub.");
            
            const files = await response.json();
            const jsonFiles = files.filter(f => f.name.endsWith('.json'));
            
            const results = await Promise.all(
                jsonFiles.map(async (file) => {
                    const r = await fetch(file.download_url);
                    return r.json();
                })
            );
            
            setData(results.sort((a, b) => b.id - a.id));
            setStatus("Success");
        } catch (err) {
            setStatus("Error: " + err.message);
        } finally {
            setLoading(false);
        }
    };

    useEffect(() => {
        if (view === "feed") loadContent();
    }, [view]);

    const handleGenerate = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        const requestObject = {
            id: Date.now(),
            hospital: fd.get("hospital"),
            location: fd.get("location"),
            items: items,
            date: new Date().toLocaleDateString('ar-EG')
        };
        const blob = new Blob([JSON.stringify(requestObject, null, 2)], {type: "application/json"});
        setFileResult({ url: URL.createObjectURL(blob), id: requestObject.id });
    };

    return (
        <div className="max-w-xl mx-auto p-4 pb-12">
            <header className="text-center py-10">
                <h1 className="text-3xl font-black text-slate-900 tracking-tighter">MEDICAL <span className="text-blue-600">HUB</span></h1>
                <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">ØªÙ†Ø³ÙŠÙ‚ ÙˆØªÙˆØ±ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</p>
            </header>

            <nav className="flex justify-around mb-8 border-b border-slate-200">
                <button onClick={() => setView("feed")} className={`pb-3 text-sm font-bold ${view === 'feed' ? 'nav-active' : 'text-slate-400'}`}>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button>
                <button onClick={() => setView("post")} className={`pb-3 text-sm font-bold ${view === 'post' ? 'nav-active' : 'text-slate-400'}`}>Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
            </nav>

            {view === "feed" ? (
                <div className="space-y-4">
                    {loading && <div className="text-center py-10 animate-pulse text-blue-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>}
                    {status.includes("Error") && (
                        <div className="bg-red-50 p-6 rounded-2xl text-red-600 text-xs text-center border border-red-100">
                            {status} <br/> ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (Public) ÙˆØ£Ù† Ø§Ù„Ù…Ø¬Ù„Ø¯ (ads) Ù…ÙˆØ¬ÙˆØ¯.
                        </div>
                    )}
                    {!loading && data.length === 0 && !status.includes("Error") && (
                        <div className="text-center py-20 text-slate-400 glass">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ø±ÙˆØ¶Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
                    )}

                    {data.map(req => (
                        <div key={req.id} className="glass p-6 border-r-8 border-blue-600 hover:shadow-lg transition-shadow">
                            <div className="flex justify-between items-start mb-4">
                                <h3 className="text-lg font-black text-slate-800">{req.hospital}</h3>
                                <span className="text-[10px] font-bold text-slate-400">{req.date}</span>
                            </div>
                            <div className="bg-slate-50 rounded-xl p-4 mb-4">
                                <p className="text-[10px] font-black text-blue-600 mb-2 uppercase tracking-widest">Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</p>
                                <ul className="text-sm space-y-2">
                                    {req.items.map((it, i) => (
                                        <li key={i} className="flex justify-between border-b border-slate-200 last:border-0 pb-1">
                                            <span className="font-medium text-slate-700">{it.name}</span>
                                            <span className="font-black text-blue-700">{it.qty}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                            <div className="flex justify-between items-center">
                                <span className="text-[10px] text-slate-500 font-bold">ğŸ“ {req.location}</span>
                                <a href={`https://wa.me/${CONFIG.whatsapp}?text=${encodeURIComponent(`Ø£ÙˆØ¯ ØªÙ‚Ø¯ÙŠÙ… Ø¹Ø±Ø¶ Ù„Ù„Ø·Ù„Ø¨ Ø±Ù‚Ù… ${req.id} Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ ${req.hospital}`)}`} 
                                   className="bg-[#128C7E] text-white px-5 py-2.5 rounded-xl text-xs font-bold shadow-md hover:bg-[#075e54]">ØªÙ‚Ø¯ÙŠÙ… Ø¹Ø±Ø¶ Ø³Ø¹Ø±</a>
                            </div>
                        </div>
                    ))}
                </div>
            ) : (
                <div className="glass p-8">
                    {!fileResult ? (
                        <form onSubmit={handleGenerate} className="space-y-6">
                            <div>
                                <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block px-2">Ø§Ù„Ø¬Ù‡Ø© (Ù…Ø³ØªØ´ÙÙ‰ / Ø¬Ø§Ù…Ø¹Ø© / Ù…Ø¹Ù…Ù„)</label>
                                <input required name="hospital" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù†ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ù‚" />
                            </div>
                            <div>
                                <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 block px-2">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                                <input required name="location" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚Ø©" />
                            </div>
                            <div className="pt-4 border-t border-slate-100">
                                <p className="text-[10px] font-bold text-slate-400 mb-4 uppercase">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª</p>
                                {items.map((it, idx) => (
                                    <div key={idx} className="flex gap-2 mb-3">
                                        <input required placeholder="Ø§Ù„ØµÙ†Ù" className="flex-1 text-sm" onChange={e => {
                                            const n = [...items]; n[idx].name = e.target.value; setItems(n);
                                        }} />
                                        <input required placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" className="w-24 text-sm text-center font-bold" onChange={e => {
                                            const n = [...items]; n[idx].qty = e.target.value; setItems(n);
                                        }} />
                                    </div>
                                ))}
                                <button type="button" onClick={() => setItems([...items, {name:"", qty:""}])} className="w-full py-2 border-2 border-dashed border-slate-200 rounded-xl text-[10px] font-bold text-slate-400 hover:text-blue-600 hover:border-blue-200 uppercase mt-2">
                                    + Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¥Ø¶Ø§ÙÙŠ
                                </button>
                            </div>
                            <button type="submit" className="w-full py-4 bg-slate-900 text-white rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-xl">ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù Ø§Ù„Ø·Ù„Ø¨</button>
                        </form>
                    ) : (
                        <div className="text-center py-10">
                            <div className="w-20 h-20 bg-blue-50 text-blue-600 rounded-full mx-auto mb-6 flex items-center justify-center">
                                <svg className="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7"/></svg>
                            </div>
                            <h2 className="text-xl font-black text-slate-900 mb-2">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù</h2>
                            <p className="text-sm text-slate-500 mb-10">Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø£Ø¯Ù†Ø§Ù‡ ÙˆØ±ÙØ¹Ù‡ Ù„Ù…Ø¬Ù„Ø¯ (ads) ÙÙŠ GitHub.</p>
                            <a href={fileResult.url} download={`order-${fileResult.id}.json`} className="block w-full bg-blue-600 text-white py-5 rounded-2xl font-black text-sm shadow-xl mb-4">ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù JSON</a>
                            <button onClick={() => setFileResult(null)} className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">Ø¥Ù„ØºØ§Ø¡</button>
                        </div>
                    )}
                </div>
            )}
            
            <footer className="mt-20 text-center">
                <p className="text-[8px] font-bold text-slate-300 uppercase tracking-[0.5em]">Medical Hub â€¢ Logistics Interface â€¢ 2025</p>
            </footer>
        </div>
    );
}

// Fixed Render Logic
const rootNode = document.getElementById("root");
if (rootNode) {
    ReactDOM.createRoot(rootNode).render(<App />);
}
</script>

</body>
</html>
