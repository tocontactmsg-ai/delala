<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø§Ù„Ø¯Ù„Ø§Ù„Ø© â€” Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;font-family:"Tajawal",sans-serif}
  body{margin:0;background:#f7fbff;color:#0b1320;line-height:1.4}
  .container{max-width:1100px;margin:16px auto;padding:12px}
  header{background:#0078d7;color:#fff;padding:12px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
  .brand .title{font-size:24px;font-weight:900}
  nav{display:flex;gap:8px;flex-wrap:wrap}
  nav button{background:rgba(255,255,255,0.12);color:#fff;border:1px solid rgba(255,255,255,0.08);padding:8px 12px;border-radius:8px;cursor:pointer}
  nav button[aria-current="true"]{background:#fff;color:#0078d7;border:0}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0;align-items:center}
  input, textarea, select{padding:10px;border-radius:10px;border:1px solid #e6eef8;width:100%;font-size:15px;background:#fff}
  .btn{background:#0078d7;color:#fff;padding:10px 12px;border-radius:10px;border:none;cursor:pointer}
  .btn.alt{background:#6b7280}
  .grid{display:grid;grid-template-columns:repeat(1,1fr);gap:14px}
  @media (min-width:560px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media (min-width:900px){ .grid{grid-template-columns:repeat(3,1fr)} }
  .card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 8px 26px rgba(11,19,32,0.06);display:flex;flex-direction:column;transition:transform .12s}
  .card:hover{transform:translateY(-6px)}
  .media{height:220px;background:#f0f4f8;display:flex;align-items:center;justify-content:center;position:relative}
  .media img{width:100%;height:100%;object-fit:cover;display:block}
  .body{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
  .title{font-weight:700;font-size:17px}
  .desc{color:#334155;font-size:14px;max-height:3.2em;overflow:hidden;text-overflow:ellipsis}
  .meta{display:flex;gap:8px;align-items:center;margin-top:auto;flex-wrap:wrap}
  .badge{background:#eef8ff;color:#0078d7;padding:6px 8px;border-radius:999px;font-weight:700}
  .small{font-size:13px;color:#333}
  /* Modal improvements */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:999}
  .modal.open{display:flex}
  .modalCard{background:#fff;border-radius:12px;max-width:920px;width:96%;max-height:92vh;overflow:auto;padding:14px;display:flex;flex-direction:column;gap:12px}
  .modalTop{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
  .modalMedia{width:420px;max-width:100%;min-width:260px;background:#f4f6f9;border-radius:10px;overflow:hidden;display:flex;flex-direction:column;gap:8px;padding:8px}
  .modalMedia img{width:100%;height:auto;object-fit:contain;border-radius:8px}
  .thumbRow{display:flex;gap:8px;overflow-x:auto;padding-top:6px}
  .thumbRow img{width:64px;height:48px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent}
  .thumbRow img.selected{border-color:#0b84ff}
  .modalBody{flex:1;display:flex;flex-direction:column;gap:8px}
  .detailsList{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .detailsItem{background:#fbfdff;padding:10px;border-radius:8px;border:1px solid #eef6ff}
  @media(max-width:820px){
    .modalTop{flex-direction:column}
    .modalMedia{width:100%}
    .detailsList{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="container" id="app">
  <header>
    <div class="brand"><div class="title">Ø§Ù„Ø¯Ù„Ø§Ù„Ø©</div></div>
    <nav aria-label="ÙˆØ§Ø¬Ù‡Ø©">
      <button data-target="home" class="nav-btn" aria-current="true">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button data-target="send" class="nav-btn">Ø£Ø±Ø³Ù„ Ø¥Ø¹Ù„Ø§Ù†Ùƒ</button>
      <button data-target="privacy" class="nav-btn">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button>
    </nav>
  </header>
  <div class="controls" role="search" aria-label="Ø¨Ø­Ø« ÙˆØªØ­ÙƒÙ…">
    <div style="flex:1;min-width:180px"><input id="q" type="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² Ø£Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹"></div>
    <div style="width:200px"><select id="catFilter"><option value="">ÙƒÙ„ Ø§Ù„Ø§Ù‚Ø³Ø§Ù…</option></select></div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="refresh" class="btn alt">âŸ³ ØªØ­Ø¯ÙŠØ«</button>
      <div id="count" class="small" aria-live="polite">ØªØ­Ù…ÙŠÙ„...</div>
    </div>
  </div>

  <main>
    <!-- HOME: ads grid -->
    <section id="home" aria-live="polite">
      <div id="grid" class="grid" role="list" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª"></div>
      <div id="noitems" style="display:none;text-align:center;margin-top:12px" class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
      <button id="loadMore" class="loadMore" style="display:none">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯</button>
    </section>

    <!-- SEND: ad form -->
    <section id="send" style="display:none">
      <div class="panel">
             <h2>Ù„ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„ÙŠ Ø§Ø¹Ù„Ø§Ù† : </h2>
  </h1>
  -Ø§Ø³ØªØ®Ø¯Ù… Ù…ØªØµÙØ­ ÙƒØ±ÙˆÙ… Ù„Ø§ÙØ¶Ù„ Ø§Ø¯Ø§Ø¡  
 <br>-Ø§Ù…Ù„Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©  
 <br>-Ø§Ø¶ØºØ· Ø¨Ø¯Ø¡ Ù„Ø§Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚ØªÙƒ ÙˆØ¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„Ù‡Ø§  
 <br>- Ø§Ø¶ØºØ· Ø¹Ù„ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©  
 <br>- ÙÙŠ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø³ØªØ¬Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ø±Ø³Ù„Ù‡Ø§ Ù„ØªÙƒØªÙ…Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ§ÙƒÙŠØ¯
<br>
</h1>
<br>
        <div style="display:grid;gap:8px">
          <input id="f_name" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
          <input id="f_price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
          <textarea id="f_desc" placeholder="ÙˆØµÙ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" rows="4"></textarea>
          <input id="f_loc" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹">
          <input id="f_contact" placeholder="ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„">
          <input id="f_cat" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ">
          <div><input id="f_file" type="file" accept="image/*"></div>

          <label style="display:flex;gap:8px;align-items:center">
            <input type="checkbox" id="agree" />
            <span class="small">Ø£Ù‚Ø± Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© ÙˆØ£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· Ø§Ù„Ù†Ø´Ø±</span>
          </label>

          <div style="display:flex;gap:8px;align-items:center">
            <button id="submitBtn" class="btn">Ø¨Ø¯Ø¡</button>
            <div id="submitStatus" class="small"></div>
          </div>

          <div id="afterSubmit" style="display:none;margin-top:8px">
            <div>Ø±Ù…Ø² Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:</div>
            <div class="refBox" style="margin-top:6px">
              <div id="refCode" class="refCode" style="background:#f0f9ff;padding:6px 12px;border-radius:10px;color:#0078d7;font-weight:800"></div>
              <a id="openWa" class="small" target="_blank" style="margin-left:8px;color:#0078d7;display:none"></a>
              <button id="downloadEmbedded" class="btn alt" style="margin-left:8px;display:none">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
            </div>
          </div>

          <div id="fallbackJson" style="display:none;margin-top:8px">
            <div class="small">Ù„Ù† ÙŠØªÙ… Ù†Ø´Ø± Ø§Ø¹Ù„Ø§Ù†Ùƒ Ù…Ø§Ù„Ù… ØªØ±Ø³Ù„ Ù„Ù†Ø§ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©. Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªØ¬Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª.</div>
          </div>

          <div id="previewCard" class="subCard" style="display:none">
            <div id="previewCanvasWrap"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- PRIVACY -->
    <section id="privacy" style="display:none">
      <div class="panel">
        <h3>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h3>
        <div style="white-space:pre-wrap;background:#fff;padding:12px;border-radius:8px;border:1px solid #eef6ff;margin-top:8px">
Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯Ù„Ø§Ù„Ø© ÙØ£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ·. Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ§ÙÙ‚ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹
ÙŠÙ‚Ø¯Ù‘Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø®Ø¯Ù…Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠ ÙˆØ±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø¯ÙˆÙ† ØªÙ‚Ø¯ÙŠÙ… Ø£ÙŠ Ø¶Ù…Ø§Ù†Ø§Øª Ø­ÙˆÙ„ Ø¯Ù‚ØªÙ‡Ø§ Ø£Ùˆ Ù…ØµØ¯Ø§Ù‚ÙŠØªÙ‡Ø§ Ø£Ùˆ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø£Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©. 
Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø§Ù…Ù„Ø§Øª Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ† ØªØªÙ… Ø¹Ù„Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©ØŒ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ÙŠØ³ Ø·Ø±ÙÙ‹Ø§ ÙÙŠÙ‡Ø§ ÙˆÙ„Ø§ ÙŠØªØ­Ù…Ù„ Ø£ÙŠ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¹Ù† Ù†ØªØ§Ø¦Ø¬Ù‡Ø§.
ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©ØŒ ÙˆØ¹Ø¯Ù… Ù†Ø´Ø± Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ù…Ø®Ø§Ù„Ù Ø£Ùˆ Ù…Ø¶Ù„Ù„ Ø£Ùˆ Ù…Ù†ØªÙ‡Ùƒ Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†ØŒ ÙˆØ¹Ø¯Ù… Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø®ØªØ±Ø§Ù‚ Ø£Ùˆ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ù…Ø´Ø±ÙˆØ¹ , Ø£ÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨ Ù‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø­Ø¸Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¯ÙˆÙ† Ø¥Ø´Ø¹Ø§Ø±.
Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø§Ù„ÙÙƒØ±ÙŠØ© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„ØªØµÙ…ÙŠÙ…ØŒ Ø§Ù„Ø´Ø¹Ø§Ø±ØŒ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŒ ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯ØŒ Ù‡ÙŠ Ù…Ù„Ùƒ Ù„Ù„Ø¯Ù„Ø§Ù„Ø©  ÙŠÙ…Ù†Ø¹ Ù†Ø³Ø® Ø£ÙŠ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù„Ø§Ù…ØªÙ‡ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© Ø¯ÙˆÙ† Ø¥Ø°Ù† Ù…Ø³Ø¨Ù‚.
Ù‚Ø¯ ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ù…Ø­ØªÙˆØ§Ù‡Ø§ Ø£Ùˆ Ø³Ù„Ø§Ù…ØªÙ‡Ø§. 
Ù‚Ø¯ ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¥Ø¹Ù„Ø§Ù† Ø£Ùˆ Ù…Ø­ØªÙˆÙ‰ Ù…ØªÙ‰ Ø´Ø§Ø¡ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø°ÙƒØ± Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨.
Ù‚Ø¯ ÙŠØªÙ… Ø¬Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø«Ù„ Ù…Ù„ÙØ§Øª Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø· ÙˆØ³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…ØŒ ÙˆÙŠÙ…ÙƒÙ† Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø· Ù„Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù‚Ø§Ù†ÙˆÙ† Ø£Ùˆ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù‡Ø¬Ù…Ø§Øª.
Ù‚Ø¯ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ· Ù…Ù† ÙˆÙ‚Øª Ù„Ø¢Ø®Ø±ØŒ ÙˆÙŠØ¹ØªØ¨Ø± Ø§Ø³ØªÙ…Ø±Ø§Ø±Ùƒ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©.
 
tocontactmsg@gmail.com  </div>
      </div>
    </section>
  </main>
</div>
<!-- Modal -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modalCard" role="document" aria-labelledby="modalTitle">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div>
        <div id="modalTitle" style="font-weight:800;font-size:18px"></div>
        <div id="modalMeta" class="small" style="margin-top:6px"></div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="refBox">
          <div id="modalRef" class="refCode"></div>
          <button id="modalCopy" class="copyBtn">Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²</button>
        </div>
        <button id="modalClose" class="btn alt">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>

    <div class="modalTop">
      <div class="modalMedia" id="modalMedia">
        <img id="modalMainImg" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" />
        <div class="thumbRow" id="modalThumbs" aria-hidden="false"></div>
      </div>

      <div class="modalBody">
        <div id="modalDescription" class="fullDesc"></div>
        <div class="detailsList">
          <div class="detailsItem"><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹</strong><div id="modalLoc" class="muted"></div></div>
          <div class="detailsItem"><strong>Ø§Ù„ØªØµÙ†ÙŠÙ</strong><div id="modalCat" class="badge"></div></div>
          <div class="detailsItem"><strong>Ø§Ù„Ø³Ø¹Ø±</strong><div id="modalPrice" class="price"></div></div>
          <div class="detailsItem"><strong>Ø§Ù„ØªÙˆØ§ØµÙ„</strong><div id="modalContact" class="muted"></div></div>
        </div>
      </div>
    </div>

    <div class="modalFooter" style="display:flex;gap:8px;align-items:center;justify-content:space-between">
      <div style="display:flex;gap:8px;align-items:center">
        <a id="modalWhats" class="btn" target="_blank">Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± WhatsApp</a>
        <a id="modalCall" class="btn alt" style="display:none" href="#">Ø§ØªØµØ§Ù„</a>
        <button id="modalDownloadCard" class="btn" style="display:none">â¬‡ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
      </div>
      <div class="small muted">Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø±.</div>
    </div>
  </div>
</div>

<button id="adminBtn" class="adminBtn" style="display:none">ğŸ”§ Admin</button>
<div id="adminPanel" class="adminPanel" style="display:none"></div>
<script>
/* Utilities */
const CFG_KEY = 'static_ads_cfg_v1';
const CACHE_KEY = 'static_ads_cache_v1';
const MARKER = 'ELDELALA_PAYLOAD:';

function escapeHtml(s){ return String(s||'').replace(/[&<>\"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]||c)); }
function debounce(fn,t=300){ let timer; return (...a)=>{ clearTimeout(timer); timer=setTimeout(()=>fn(...a),t); }; }
function genRef(){ return 'R' + Date.now().toString(36).slice(-6).toUpperCase(); }

/* Simple local dataset (in-memory) */
let ads = []; // will hold objects {ref_code,name,price,description,location,contact,category,image,thumb,_blobUrl,...}
const grid = document.getElementById('grid');
const qEl = document.getElementById('q');
const catFilter = document.getElementById('catFilter');
const countEl = document.getElementById('count');
const loadMoreBtn = document.getElementById('loadMore');

/* Navigation */
document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('main > section').forEach(s=> s.style.display='none');
    document.getElementById(btn.dataset.target).style.display='block';
    document.querySelectorAll('.nav-btn').forEach(n=>n.removeAttribute('aria-current'));
    btn.setAttribute('aria-current','true');
    window.scrollTo({top:0,behavior:'smooth'});
  });
});

/* Render grid */
function renderGrid(list){
  grid.innerHTML='';
  list = list || ads;
  if(!list.length){ document.getElementById('noitems').style.display='block'; countEl.textContent='0 Ø¥Ø¹Ù„Ø§Ù†'; return; }
  document.getElementById('noitems').style.display='none';
  list.forEach(a=>{
    const el = document.createElement('div'); el.className='card';
    const thumb = a.thumb || a._blobUrl || '';
    const mediaHtml = thumb ? `<img src="${escapeHtml(thumb)}" alt="${escapeHtml(a.name||'')}">` : `<div class="noimg small">Ù„Ø§ ØµÙˆØ±Ø©</div>`;
    el.innerHTML = `<div class="media">${mediaHtml}</div>
      <div class="body"><div class="title">${escapeHtml(a.name||'')}</div>
      <div class="desc">${escapeHtml(a.description||'')}</div>
      <div class="meta"><div class="badge">${escapeHtml(a.category||'Ø¹Ø§Ù…')}</div><div style="margin-left:auto" class="small">${escapeHtml(a.ref_code||'')}</div></div></div>`;
    el.addEventListener('click', ()=> openDetails(a));
    grid.appendChild(el);
  });
  countEl.textContent = list.length + ' Ø¥Ø¹Ù„Ø§Ù†';
}

/* Open details modal */
const modal = document.getElementById('modal');
const modalMainImg = document.getElementById('modalMainImg');
const modalThumbs = document.getElementById('modalThumbs');
const modalTitle = document.getElementById('modalTitle');
const modalMeta = document.getElementById('modalMeta');
const modalRef = document.getElementById('modalRef');
const modalDescription = document.getElementById('modalDescription');
const modalLoc = document.getElementById('modalLoc');
const modalCat = document.getElementById('modalCat');
const modalPrice = document.getElementById('modalPrice');
const modalContact = document.getElementById('modalContact');
const modalWhats = document.getElementById('modalWhats');
const modalCall = document.getElementById('modalCall');
const modalDownloadCard = document.getElementById('modalDownloadCard');
const modalCopy = document.getElementById('modalCopy');
const modalClose = document.getElementById('modalClose');

modalClose.addEventListener('click', ()=>{ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); });

function openDetails(item){
  modalTitle.textContent = item.name || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
  modalMeta.textContent = `Ø±Ù…Ø²: ${item.ref_code||''}`;
  modalRef.textContent = item.ref_code||'';
  modalDescription.textContent = item.description||'-';
  modalLoc.textContent = item.location||'-';
  modalCat.textContent = item.category||'Ø¹Ø§Ù…';
  modalPrice.textContent = item.price || '-';
  modalContact.textContent = item.contact || '-';

  // images and thumbs
  modalThumbs.innerHTML = '';
  if(item._blobUrl){ modalMainImg.src = item._blobUrl; const t=document.createElement('img'); t.src=item._blobUrl; t.className='selected'; modalThumbs.appendChild(t); }
  else if(item.thumb){ modalMainImg.src = item.thumb; const t=document.createElement('img'); t.src=item.thumb; t.className='selected'; modalThumbs.appendChild(t); }
  else { modalMainImg.src=''; modalThumbs.innerHTML = '<div class="noimg small">Ù„Ø§ ØµÙˆØ±Ø©</div>'; }

  Array.from(modalThumbs.querySelectorAll('img')).forEach(img=>{
    img.addEventListener('click', ()=>{ modalThumbs.querySelectorAll('img').forEach(i=>i.classList.remove('selected')); img.classList.add('selected'); modalMainImg.src = img.src; });
  });

  // contact / call
  if(item.contact && item.contact.trim()){
    modalCall.style.display = 'inline-block';
    const phoneDigits = (item.contact.match(/[+0-9][0-9() \\-]{4,}/) || [])[0] || item.contact;
    modalCall.href = 'tel:' + phoneDigits.replace(/\s+/g,'').replace(/[^+0-9]/g,'');
  } else modalCall.style.display = 'none';

  // download card if available for this ref
  if(window.lastEmbeddedBlob && window.lastRef === (item.ref_code||'')){
    modalDownloadCard.style.display = 'inline-block';
    modalDownloadCard.onclick = function(e){
      e.stopPropagation();
      const url = URL.createObjectURL(window.lastEmbeddedBlob);
      const a = document.createElement('a'); a.href = url; a.download = (item.ref_code||'card') + '_eldelala.png';
      document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1200);
    };
  } else if(item._blobUrl){
    modalDownloadCard.style.display = 'inline-block';
    modalDownloadCard.onclick = function(e){
      e.stopPropagation();
      const a = document.createElement('a'); a.href = item._blobUrl; a.download = (item.ref_code||'card') + '_image.png';
      document.body.appendChild(a); a.click(); a.remove();
    };
  } else modalDownloadCard.style.display = 'none';

  modalWhats.href = `https://wa.me/?text=${encodeURIComponent((item.name || '') + ' - ' + (window.location.href.split('#')[0] + '#ad-' + (item.ref_code||'')))}`;
  modalWhats.target = '_blank';

  modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
}

/* Minimal load: show empty grid initially */
renderGrid([]);
</script>
<script>
/* ---------------- Submission handler (card generation) ---------------- */
(function(){
  const submitBtn = document.getElementById('submitBtn');
  const submitStatus = document.getElementById('submitStatus');
  const afterSubmit = document.getElementById('afterSubmit');
  const refCodeEl = document.getElementById('refCode');
  const downloadEmbeddedBtn = document.getElementById('downloadEmbedded');
  const openWa = document.getElementById('openWa');
  const f_name = document.getElementById('f_name');
  const f_price = document.getElementById('f_price');
  const f_desc = document.getElementById('f_desc');
  const f_loc = document.getElementById('f_loc');
  const f_contact = document.getElementById('f_contact');
  const f_cat = document.getElementById('f_cat');
  const f_file = document.getElementById('f_file');
  const agree = document.getElementById('agree');
  const previewCanvasWrap = document.getElementById('previewCanvasWrap');
  const fallbackBox = document.getElementById('fallbackJson');

  let lastEmbeddedBlob = null;
  let lastRef = null;
  window.lastEmbeddedBlob = lastEmbeddedBlob;
  window.lastRef = lastRef;

  function showStatus(msg, isError=false){ submitStatus.textContent = msg; submitStatus.style.color = isError ? '#b45309' : '#0b84ff'; }

  submitBtn.addEventListener('click', async ()=>{
    try{
      if(submitBtn.disabled) return;
      submitBtn.disabled = true;
      showStatus('Ø¬Ø§Ø±Ù ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†...');
      if(!f_name.value || f_name.value.trim().length < 2){ showStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†', true); submitBtn.disabled = false; return; }
      if(!agree.checked){ showStatus('ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·', true); submitBtn.disabled = false; return; }

      const ref = genRef();
      lastRef = ref;
      refCodeEl.textContent = ref;
      afterSubmit.style.display = 'block';
      downloadEmbeddedBtn.style.display = 'none';
      if(openWa) openWa.style.display = 'none';
      showStatus('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©...');

      const payload = {
        ref_code: ref,
        name: f_name.value.trim(),
        price: f_price.value.trim(),
        description: f_desc.value.trim(),
        location: f_loc.value.trim(),
        contact: f_contact.value.trim(),
        category: f_cat.value.trim(),
        created_at: new Date().toISOString(),
        image: '' // we omit heavy inline image in JSON payload to keep size lower
      };

      // file fallback placeholder
      let inputFile = f_file.files && f_file.files[0] ? f_file.files[0] : null;
      let fileToUse = inputFile;
      if(!fileToUse){
        // create tiny white placeholder
        const c = document.createElement('canvas'); c.width=2; c.height=2;
        const ctx = c.getContext('2d'); ctx.fillStyle='white'; ctx.fillRect(0,0,2,2);
        fileToUse = await new Promise(r=>c.toBlob(r,'image/png')).then(b=> new File([b],'placeholder.png',{type:'image/png'}));
      }

      const built = await buildVisualAndDataURL(fileToUse, payload, { compact: true });
      const visualBlob = built.blob;
      previewCanvasWrap.innerHTML = '';
      const imgEl = document.createElement('img'); imgEl.style.width='100%'; imgEl.src = built.dataURL; previewCanvasWrap.appendChild(imgEl);
      document.getElementById('previewCard').style.display='block';

      // downscale to reasonable size
      let smallPng;
      try{ smallPng = await downscalePngBlob(visualBlob, 900, 600); }catch(e){ smallPng = visualBlob; }

      // embed payload
      const embedded = await embedJsonInImageBlob(smallPng, payload);
      lastEmbeddedBlob = embedded;
      window.lastEmbeddedBlob = lastEmbeddedBlob;
      window.lastRef = lastRef;

      // create object URL & show download button
      if(typeof lastEmbeddedBlob === 'object'){
        const url = URL.createObjectURL(lastEmbeddedBlob);
        downloadEmbeddedBtn.style.display = 'inline-block';
        downloadEmbeddedBtn.onclick = function(){
          const a = document.createElement('a'); a.href = url; a.download = payload.ref_code + '_eldelala.png';
          document.body.appendChild(a); a.click();
          setTimeout(()=>{ URL.revokeObjectURL(url); a.remove();
            // reveal whatsapp link now
            if(openWa){
              openWa.style.display = 'inline-block';
              const base = window.location.href.split('#')[0];
              const adLink = base + '#ad-' + payload.ref_code;
              const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£ÙˆØ¯ Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø±Ù…Ø²: ${payload.ref_code}\nØ§Ù„Ø¹Ù†ÙˆØ§Ù†: ${payload.name || '-'}\nØ§Ù„Ø³Ø¹Ø±: ${payload.price || '-'}\nØ³Ø£Ø±ÙÙ‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (${payload.ref_code}_eldelala.png). ${adLink}`;
              openWa.href = 'https://wa.me/?text=' + encodeURIComponent(msg);
              openWa.target = '_blank';
              openWa.textContent = 'ÙØªØ­ WhatsApp Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø§Ø¶ØºØ· Ù„ÙØªØ­)';
            }
          },800);
        };
      }

      showStatus('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ­Ù…ÙŠÙ„Ù‡Ø§.');
      fallbackBox.style.display = 'block';
    }catch(err){
      console.error(err);
      showStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡.', true);
    }finally{
      submitBtn.disabled = false;
    }
  });
})();

/* ----------------- helper functions for images, canvas, QR ----------------- */

async function jsonToBase64String(obj){
  const json = JSON.stringify(obj);
  const utf8 = unescape(encodeURIComponent(json));
  return btoa(utf8);
}
async function blobToUint8(blob){
  const ab = await blob.arrayBuffer();
  return new Uint8Array(ab);
}
async function embedJsonInImageBlob(imageBlob, payloadObj){
  const origBytes = await blobToUint8(imageBlob);
  const markerBytes = new TextEncoder().encode(MARKER);
  const b64 = await jsonToBase64String(payloadObj); // IMPORTANT: await here
  const b64Bytes = new TextEncoder().encode(b64);
  const out = new Uint8Array(origBytes.length + markerBytes.length + b64Bytes.length);
  out.set(origBytes,0);
  out.set(markerBytes, origBytes.length);
  out.set(b64Bytes, origBytes.length + markerBytes.length);
  return new Blob([out], { type: imageBlob.type || 'image/png' });
}

async function downscalePngBlob(blob, maxW=900, maxH=600){
  const dataUrl = await new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(blob); });
  const img = await new Promise((res,rej)=>{ const i=new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=dataUrl; });
  let w = img.width, h = img.height;
  const scale = Math.min(1, maxW / w, maxH / h);
  const cw = Math.max(200, Math.round(w * scale));
  const ch = Math.max(200, Math.round(h * scale));
  const c = document.createElement('canvas'); c.width = cw; c.height = ch;
  const ctx = c.getContext('2d'); ctx.imageSmoothingEnabled = true; ctx.imageSmoothingQuality = 'high';
  ctx.drawImage(img, 0, 0, cw, ch);
  return await new Promise(res=>c.toBlob(res, 'image/png'));
}

/* REPLACE ONLY: buildVisualAndDataURL (clean, minimal card output) */
async function buildVisualAndDataURL(file, data = {}, opts = { compact: true }) {
  const compact = !!opts.compact;
  const W = compact ? 900 : 1400;
  const H = compact ? 600 : 900;
  const pad = Math.round(W * 0.04);
  const cv = document.createElement('canvas');
  cv.width = W; cv.height = H;
  const ctx = cv.getContext('2d');

  // Colors
  const BG = '#0b1220';
  const PANEL = '#0f1724';
  const WHITE = '#ffffff';
  const ACCENT = '#0078d7';
  const TEXT_DARK = '#0b1220';

  // Layout
  const leftW = Math.round(W * 0.55);
  const rightX = pad + leftW + Math.round(W * 0.02);
  const rightW = W - rightX - pad;
  const contentH = H - pad * 2;

  // Background + main panel
  ctx.fillStyle = BG; ctx.fillRect(0, 0, W, H);
  ctx.save();
  roundRect(ctx, pad, pad, W - pad * 2, contentH, 22);
  ctx.fillStyle = PANEL; ctx.fill();
  ctx.restore();

  // Left image area (framed)
  const imgX = pad + 12, imgY = pad + 12;
  const imgW = leftW - 24, imgH = contentH - 24;
  ctx.save();
  roundRect(ctx, imgX, imgY, imgW, imgH, 16);
  ctx.fillStyle = '#07121a'; ctx.fill();
  ctx.restore();

  // Load image (File or URL) safely
  let imgEl = null;
  try {
    if (file instanceof File) {
      imgEl = await new Promise((res) => {
        const fr = new FileReader();
        fr.onload = () => { const I = new Image(); I.onload = () => res(I); I.onerror = () => res(null); I.src = fr.result; };
        fr.onerror = () => res(null);
        fr.readAsDataURL(file);
      });
    } else if (typeof file === 'string' && file.length) {
      imgEl = new Image(); imgEl.crossOrigin = 'anonymous';
      await new Promise((res) => { imgEl.onload = res; imgEl.onerror = res; imgEl.src = file; });
    } else {
      imgEl = new Image(); imgEl.crossOrigin = 'anonymous';
      imgEl.src = '/mnt/data/R5VXSZ1_eldelala.png';
      await new Promise((res) => { imgEl.onload = res; imgEl.onerror = res; });
    }
  } catch (e) {
    imgEl = null;
  }

  // Draw image (cover) clipped
  if (imgEl && imgEl.width) {
    ctx.save();
    clipRoundRect(ctx, imgX, imgY, imgW, imgH, 16);
    const scale = Math.max(imgW / imgEl.width, imgH / imgEl.height);
    const dw = Math.round(imgEl.width * scale), dh = Math.round(imgEl.height * scale);
    const dx = imgX + Math.round((imgW - dw) / 2), dy = imgY + Math.round((imgH - dh) / 2);
    ctx.drawImage(imgEl, dx, dy, dw, dh);
    ctx.restore();
  }

  // Right white panel (clean)
  ctx.save();
  roundRect(ctx, rightX, pad, rightW, contentH, 18);
  ctx.fillStyle = WHITE; ctx.fill();
  ctx.restore();

  // Accent bar
  ctx.fillStyle = ACCENT;
  ctx.fillRect(rightX + 12, pad + 12, 6, contentH - 24);

  // Elements to show
  const phrase = data.phrase || 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯Ù„Ø§Ù„Ø©';
  const ref = data.ref_code || 'REF000';

  // Phrase pill (top-right)
  ctx.font = compact ? '600 16px Tajawal, sans-serif' : '600 5px Tajawal, sans-serif';
  ctx.textAlign = 'center';
  const maxPhraseW = rightW - 120;
  const measured = ctx.measureText(phrase).width;
  const phraseW = Math.min(maxPhraseW, Math.ceil(measured) + 36);
  const phraseH = compact ? 40 : 46;
  const phraseBoxX = rightX + rightW - 24 - phraseW;
  const phraseBoxY = pad + 48;
  ctx.save();
  roundRect(ctx, phraseBoxX, phraseBoxY, phraseW, phraseH, 12);
  ctx.fillStyle = ACCENT; ctx.fill();
  ctx.fillStyle = WHITE;
  ctx.fillText(phrase, phraseBoxX + phraseW / 2, phraseBoxY + phraseH * 0.68);
  ctx.restore();

  // REF (large, left inside white panel)
  ctx.textAlign = 'left';
  ctx.fillStyle = TEXT_DARK;
  ctx.font = compact ? '800 36px Tajawal, sans-serif' : '800 48px Tajawal, sans-serif';
  const refX = rightX + 22;
  const refY = phraseBoxY + phraseH + (compact ? 36 : 46);
  ctx.fillText(ref, refX, refY);

  // QR (centered under REF)
  const qrSize = Math.min(rightW - 80, Math.round(contentH * 0.42), 300);
  const qrX = rightX + Math.round((rightW - qrSize) / 2);
  const qrY = refY + 18;

  const qrData = data.qr || `https://eldelala.example/#ad-${encodeURIComponent(ref)}`;
  const qrApi = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encodeURIComponent(qrData)}&margin=0`;

  // Frame for QR: accent border + dark inner
  ctx.save();
  roundRect(ctx, qrX - 12, qrY - 12, qrSize + 24, qrSize + 24, 16); ctx.fillStyle = ACCENT; ctx.fill();
  roundRect(ctx, qrX - 8, qrY - 8, qrSize + 16, qrSize + 16, 14); ctx.fillStyle = PANEL; ctx.fill();
  ctx.restore();

  // draw QR image (graceful fallback)
  try {
    const qimg = await new Promise(res => {
      const Q = new Image(); Q.crossOrigin = 'anonymous';
      Q.onload = () => res(Q); Q.onerror = () => res(null);
      Q.src = qrApi;
    });
    if (qimg) ctx.drawImage(qimg, qrX, qrY, qrSize, qrSize);
    else { ctx.fillStyle = WHITE; ctx.fillRect(qrX, qrY, qrSize, qrSize); }
  } catch (e) {
    ctx.fillStyle = WHITE; ctx.fillRect(qrX, qrY, qrSize, qrSize);
  }

  // Export PNG blob + dataURL
  const blob = await new Promise(res => cv.toBlob(res, 'image/png'));
  const dataURL = await new Promise(res => { const fr = new FileReader(); fr.onload = () => res(fr.result); fr.readAsDataURL(blob); });
  return { blob, dataURL, canvas: cv };
}

/* Canvas helpers */
function roundRect(ctx, x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx.lineTo(x + w, y + h - r);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx.lineTo(x + r, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
}
function clipRoundRect(ctx, x, y, w, h, r) {
  ctx.save();
  roundRect(ctx, x, y, w, h, r);
  ctx.clip();
}
function wrapTextRTL(ctx, text, x, y, maxWidth, lineHeight) {
  const words = String(text || '').split(' ');
  let line = '';
  let curY = y;
  for (let i = 0; i < words.length; i++) {
    const testLine = (line ? (words[i] + ' ' + line) : words[i]);
    const metrics = ctx.measureText(testLine);
    if (metrics.width > maxWidth && line) {
      ctx.fillText(line, x, curY);
      line = words[i];
      curY += lineHeight;
    } else {
      line = testLine;
    }
  }
  if (line) ctx.fillText(line, x, curY);
  return curY;
}
</script>
</body>
</html>
